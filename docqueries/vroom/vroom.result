BEGIN;
BEGIN
SET client_min_messages TO NOTICE;
SET
SET TIMEZONE TO 'UTC';
SET
SELECT (to_timestamp(1630573200) at time zone 'UTC')::TIMESTAMP;
      timezone
---------------------
 2021-09-02 09:00:00
(1 row)

/* -- q1 */
SELECT *
FROM vrp_vroom(
  'SELECT * FROM vroom.jobs',
  'SELECT * FROM vroom.jobs_time_windows',
  'SELECT * FROM vroom.shipments',
  'SELECT * FROM vroom.shipments_time_windows',
  'SELECT * FROM vroom.vehicles',
  'SELECT * FROM vroom.breaks',
  'SELECT * FROM vroom.breaks_time_windows',
  'SELECT * FROM vroom.matrix'
);
 seq | vehicle_seq | vehicle_id | vehicle_data | step_seq | step_type | task_id | location_id | task_data |       arrival       | travel_time | setup_time | service_time | waiting_time |      departure      | load
-----+-------------+------------+--------------+----------+-----------+---------+-------------+-----------+---------------------+-------------+------------+--------------+--------------+---------------------+------
   1 |           1 |          1 | {}           |        1 |         1 |      -1 |           1 | {}        | 2021-09-02 08:05:00 | 00:00:00    | 00:00:00   | 00:00:00     | 00:00:00     | 2021-09-02 08:05:00 | {50}
   2 |           1 |          1 | {}           |        2 |         5 |       1 |           1 | {}        | 2021-09-02 08:05:00 | 00:00:00    | 00:00:00   | 00:00:00     | 00:00:00     | 2021-09-02 08:05:00 | {50}
   3 |           1 |          1 | {}           |        3 |         2 |       5 |           4 | {}        | 2021-09-02 08:06:15 | 00:01:15    | 00:00:00   | 00:04:10     | 00:10:50     | 2021-09-02 08:21:15 | {50}
   4 |           1 |          1 | {}           |        4 |         2 |       2 |           2 | {}        | 2021-09-02 08:22:45 | 00:01:30    | 00:00:00   | 00:04:10     | 00:00:00     | 2021-09-02 08:26:55 | {50}
   5 |           1 |          1 | {}           |        5 |         3 |       5 |           2 | {}        | 2021-09-02 08:26:55 | 00:00:00    | 00:00:00   | 00:37:30     | 03:15:35     | 2021-09-02 12:20:00 | {60}
   6 |           1 |          1 | {}           |        6 |         3 |       3 |           1 | {}        | 2021-09-02 12:20:50 | 00:00:50    | 00:00:00   | 00:37:30     | 00:00:00     | 2021-09-02 12:58:20 | {80}
   7 |           1 |          1 | {}           |        7 |         4 |       5 |           2 | {}        | 2021-09-02 12:59:10 | 00:00:50    | 00:00:00   | 00:37:30     | 00:03:45     | 2021-09-02 13:40:25 | {70}
   8 |           1 |          1 | {}           |        8 |         4 |       3 |           2 | {}        | 2021-09-02 13:40:25 | 00:00:00    | 00:00:00   | 00:37:30     | 00:03:20     | 2021-09-02 14:21:15 | {50}
   9 |           1 |          1 | {}           |        9 |         6 |      -1 |           1 | {}        | 2021-09-02 14:22:05 | 00:00:50    | 00:00:00   | 00:00:00     | 00:00:00     | 2021-09-02 14:22:05 | {50}
  10 |           1 |          1 | {}           |        0 |         0 |       0 |           0 | {}        | 1970-01-01 00:00:00 | 00:05:15    | 00:00:00   | 02:38:20     | 03:33:30     | 1970-01-01 00:00:00 | {}
  11 |           2 |          2 | {}           |        1 |         1 |      -1 |           1 | {}        | 2021-09-02 08:04:35 | 00:00:00    | 00:00:00   | 00:00:00     | 00:00:00     | 2021-09-02 08:04:35 | {0}
  12 |           2 |          2 | {}           |        2 |         5 |       2 |           1 | {}        | 2021-09-02 08:04:35 | 00:00:00    | 00:00:00   | 00:00:10     | 00:00:00     | 2021-09-02 08:04:45 | {0}
  13 |           2 |          2 | {}           |        3 |         3 |       2 |           5 | {}        | 2021-09-02 08:06:31 | 00:01:46    | 00:00:00   | 00:37:30     | 00:00:00     | 2021-09-02 08:44:01 | {10}
  14 |           2 |          2 | {}           |        4 |         3 |       1 |           3 | {}        | 2021-09-02 08:44:26 | 00:00:25    | 00:00:00   | 00:37:30     | 00:00:00     | 2021-09-02 09:21:56 | {20}
  15 |           2 |          2 | {}           |        5 |         4 |       2 |           6 | {}        | 2021-09-02 09:23:26 | 00:01:30    | 00:00:00   | 00:37:30     | 00:00:00     | 2021-09-02 10:00:56 | {10}
  16 |           2 |          2 | {}           |        6 |         3 |       4 |           1 | {}        | 2021-09-02 10:03:03 | 00:02:07    | 00:00:00   | 00:37:30     | 00:00:00     | 2021-09-02 10:40:33 | {30}
  17 |           2 |          2 | {}           |        7 |         4 |       4 |           4 | {}        | 2021-09-02 10:41:48 | 00:01:15    | 00:00:00   | 00:37:30     | 00:00:00     | 2021-09-02 11:19:18 | {10}
  18 |           2 |          2 | {}           |        8 |         4 |       1 |           5 | {}        | 2021-09-02 11:20:33 | 00:01:15    | 00:00:00   | 00:37:30     | 03:34:52     | 2021-09-02 15:32:55 | {0}
  19 |           2 |          2 | {}           |        9 |         6 |      -1 |           3 | {}        | 2021-09-02 15:33:20 | 00:00:25    | 00:00:00   | 00:00:00     | 00:00:00     | 2021-09-02 15:33:20 | {0}
  20 |           2 |          2 | {}           |        0 |         0 |       0 |           0 | {}        | 1970-01-01 00:00:00 | 00:08:43    | 00:00:00   | 03:45:10     | 03:34:52     | 1970-01-01 00:00:00 | {}
  21 |           3 |          3 | {}           |        1 |         1 |      -1 |           1 | {}        | 2021-09-02 08:00:00 | 00:00:00    | 00:00:00   | 00:00:00     | 00:00:00     | 2021-09-02 08:00:00 | {20}
  22 |           3 |          3 | {}           |        2 |         5 |       3 |           1 | {}        | 2021-09-02 08:00:00 | 00:00:00    | 00:00:00   | 00:00:00     | 00:00:00     | 2021-09-02 08:00:00 | {20}
  23 |           3 |          3 | {}           |        3 |         2 |       1 |           1 | {}        | 2021-09-02 08:00:00 | 00:00:00    | 00:00:00   | 00:04:10     | 01:00:25     | 2021-09-02 09:04:35 | {20}
  24 |           3 |          3 | {}           |        4 |         6 |      -1 |           1 | {}        | 2021-09-02 09:04:35 | 00:00:00    | 00:00:00   | 00:00:00     | 00:00:00     | 2021-09-02 09:04:35 | {20}
  25 |           3 |          3 | {}           |        0 |         0 |       0 |           0 | {}        | 1970-01-01 00:00:00 | 00:00:00    | 00:00:00   | 00:04:10     | 01:00:25     | 1970-01-01 00:00:00 | {}
  26 |           4 |          4 | {}           |        1 |         1 |      -1 |           3 | {}        | 2021-09-02 08:04:10 | 00:00:00    | 00:00:00   | 00:00:00     | 00:00:00     | 2021-09-02 08:04:10 | {50}
  27 |           4 |          4 | {}           |        2 |         5 |       4 |           1 | {}        | 2021-09-02 08:04:10 | 00:00:00    | 00:00:00   | 00:00:00     | 00:00:00     | 2021-09-02 08:04:10 | {50}
  28 |           4 |          4 | {}           |        3 |         2 |       3 |           3 | {}        | 2021-09-02 08:04:10 | 00:00:00    | 00:00:00   | 00:04:10     | 00:41:15     | 2021-09-02 08:49:35 | {50}
  29 |           4 |          4 | {}           |        4 |         2 |       4 |           3 | {}        | 2021-09-02 08:49:35 | 00:00:00    | 00:00:00   | 00:04:10     | 00:09:10     | 2021-09-02 09:02:55 | {50}
  30 |           4 |          4 | {}           |        5 |         6 |      -1 |           3 | {}        | 2021-09-02 09:02:55 | 00:00:00    | 00:00:00   | 00:00:00     | 00:00:00     | 2021-09-02 09:02:55 | {50}
  31 |           4 |          4 | {}           |        0 |         0 |       0 |           0 | {}        | 1970-01-01 00:00:00 | 00:00:00    | 00:00:00   | 00:08:20     | 00:50:25     | 1970-01-01 00:00:00 | {}
  32 |           0 |          0 | {}           |        0 |         0 |       0 |           0 | {}        | 1970-01-01 00:00:00 | 00:13:58    | 00:00:00   | 06:36:00     | 08:59:12     | 1970-01-01 00:00:00 | {}
(32 rows)

/* -- q2 */
SELECT *
FROM vrp_vroom(
  $jobs$
    SELECT * FROM (
      VALUES (1414, 2), (1515, 3)
    ) AS C(id, location_id)
  $jobs$,
  NULL,
  $shipments$
    SELECT * FROM (
      VALUES (100, 1, 4)
    ) AS C(id, p_location_id, d_location_id)
  $shipments$,
  NULL,
  $vehicles$
    SELECT * FROM (
      VALUES (1, 1, 4)
    ) AS C(id, start_id, end_id)
  $vehicles$,
  NULL,
  NULL,
  $matrix$
    SELECT start_id, end_id, make_interval(secs => duration) AS duration FROM (
      VALUES (1, 2, 2104), (1, 3, 197), (1, 4, 1299),
             (2, 1, 2103), (2, 3, 2255), (2, 4, 3152),
             (3, 1, 197), (3, 2, 2256), (3, 4, 1102),
             (4, 1, 1299), (4, 2, 3153), (4, 3, 1102)
    ) AS C(start_id, end_id, duration)
  $matrix$
);
 seq | vehicle_seq | vehicle_id | vehicle_data | step_seq | step_type | task_id | location_id | task_data |       arrival       | travel_time | setup_time | service_time | waiting_time |      departure      | load
-----+-------------+------------+--------------+----------+-----------+---------+-------------+-----------+---------------------+-------------+------------+--------------+--------------+---------------------+------
   1 |           1 |          1 | {}           |        1 |         1 |      -1 |           1 | {}        | 1970-01-01 00:00:00 | 00:00:00    | 00:00:00   | 00:00:00     | 00:00:00     | 1970-01-01 00:00:00 | {}
   2 |           1 |          1 | {}           |        2 |         3 |     100 |           1 | {}        | 1970-01-01 00:00:00 | 00:00:00    | 00:00:00   | 00:00:00     | 00:00:00     | 1970-01-01 00:00:00 | {}
   3 |           1 |          1 | {}           |        3 |         2 |    1414 |           2 | {}        | 1970-01-01 00:35:04 | 00:35:04    | 00:00:00   | 00:00:00     | 00:00:00     | 1970-01-01 00:35:04 | {}
   4 |           1 |          1 | {}           |        4 |         2 |    1515 |           3 | {}        | 1970-01-01 01:12:39 | 00:37:35    | 00:00:00   | 00:00:00     | 00:00:00     | 1970-01-01 01:12:39 | {}
   5 |           1 |          1 | {}           |        5 |         4 |     100 |           4 | {}        | 1970-01-01 01:31:01 | 00:18:22    | 00:00:00   | 00:00:00     | 00:00:00     | 1970-01-01 01:31:01 | {}
   6 |           1 |          1 | {}           |        6 |         6 |      -1 |           4 | {}        | 1970-01-01 01:31:01 | 00:00:00    | 00:00:00   | 00:00:00     | 00:00:00     | 1970-01-01 01:31:01 | {}
   7 |           1 |          1 | {}           |        0 |         0 |       0 |           0 | {}        | 1970-01-01 00:00:00 | 01:31:01    | 00:00:00   | 00:00:00     | 00:00:00     | 1970-01-01 00:00:00 | {}
   8 |           0 |          0 | {}           |        0 |         0 |       0 |           0 | {}        | 1970-01-01 00:00:00 | 01:31:01    | 00:00:00   | 00:00:00     | 00:00:00     | 1970-01-01 00:00:00 | {}
(8 rows)

/* -- q3 */
ROLLBACK;
ROLLBACK
